<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>A simple map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    <script src='https://code.jquery.com/jquery-1.12.0.min.js'></script>

    <link href='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>

    <div id='map'></div>

    <script>
        
        // Mapbox access token
        L.mapbox.accessToken = 'pk.eyJ1Ijoic2tlZXRpZG90IiwiYSI6IjJHd3UxZDgifQ.aeE1dODYNEMRwHQZT1MrLA';

        // Initialize the Mapbox map, with the Mapbox Light basemap, centered in Kenya with an initial zoom level of 6, a minimum zoom of 7, a maximum zoom of 9, and panning bounds so the user doesn't pan too far away from Kenya
        var map = L.mapbox.map('map', 'mapbox.light', {
            center: [-.23, 37.8],
            zoom: 7,
            minZoom: 6,
            maxZoom: 9,
            maxBounds: L.latLngBounds([-6.22, 27.72], [5.76, 47.83])
        });
        
        // Use the Omnivore plugin to load the Kenya county centroids with education data and add them to the map
        var countyCentroids = omnivore.csv('kenya_education_2014.csv')
            
            // If the data has been properly loaded, convert it to a traditional GeoJSON layer and call the drawMap() function
            .on('ready', function(e) {
                drawMap(e.target.toGeoJSON());
            })
            
            // If the data cannot be loaded or parsed, log an error message to the console
            .on('error', function(e) {
                console.log(e.error[0].message);
            })
        
        // Draw the map with the school enrollment data
        function drawMap(schoolData) {
            
            // Create a Leaflet GeoJson layer for girls enrollment in grade 1 and add it to the map
            var girls = L.geoJson(schoolData, {
                pointToLayer: function(feature, layer) {
                    // Create proportional circle markers whose radii are based on the number of girls in grade 1
                    return L.circleMarker(layer, {
                        color: '#D96D02', // purple
                        opacity: 1,
                        weight: 2,
                        fillOpacity: 0, // no fill
                        radius: calcRadius(Number(feature.properties.G1))
                    });
                }
            }).addTo(map);
            
            // Create a Leaflet GeoJson layer for boys enrollment in grade 1 and add it to the map
            var boys = L.geoJson(schoolData, {
                pointToLayer: function(feature, layer) {
                    // Create proportional circle markers whose radii are based on the number of boys in grade 1
                    return L.circleMarker(layer, {
                        color: '#6E77B0', // orange
                        opacity: 1,
                        weight: 2,
                        fillOpacity: 0, // no fill
                        radius: calcRadius(Number(feature.properties.B1))
                    });
                }
            }).addTo(map);
            
        }
        
        // Calculate the radius of each circle marker based on the enrollment of boys or girls in the selected grade
        function calcRadius(val) {
            var radius = Math.sqrt(val/Math.PI);
            return radius * .6;
        }
        
    </script>
</body>

</html>